






<ion-menu [content]="content">
  <ion-header>
    <ion-toolbar>
      <ion-title>Menu</ion-title>
    </ion-toolbar>
  </ion-header>

  <ion-content>
    <ion-list>
      <ng-container *ngIf="buses.length > 1">
        <button menuClose ion-item *ngFor="let bus of buses; index as i;" (click)="selectBus(i)">
          Bus #{{bus.busId}}
        </button>
      </ng-container>
      <button menuClose ion-item detail-none (click)="openSettings()">
        <ion-icon name="settings"></ion-icon> Settigs
      </button>
      <button menuClose ion-item detail-none (click)="logout()">
        <ion-icon name="log-out"></ion-icon>  Logout
      </button>
      <button menuClose ion-item detail-none (click)="changePassword()">
        <ion-icon name="ios-finger-print"></ion-icon>  Change Password
      </button>
    </ion-list>
  </ion-content>

</ion-menu>

<!-- Disable swipe-to-go-back because it's poor UX to combine STGB with side menus -->
<ion-nav [root]="rootPage" #content swipeBackEnabled="false"></ion-nav>
<ion-header>
  <ion-navbar color="default">

    <button ion-button menuToggle color="light">
      <ion-icon name="menu" ></ion-icon>
    </button>
    <ion-icon name="ios-notifications" color="color-3" class="bel" (click)="message.show = true;"></ion-icon>
    <ion-icon name="ios-refresh-circle-outline" color="color-3" class="bel" *ngIf="!isBusMoving" (click)="getBusses()"></ion-icon>
    <ion-icon name="ios-locate-outline" color="color-3" class="bel" *ngIf="isBusMoving" (click)="locateBus()"></ion-icon>
  </ion-navbar>
</ion-header>

<ion-content>
  <page-home (notification)="onNotification($event)" (isBusMoving)="onBusMoving($event)"></page-home>
</ion-content>

<ion-footer>

  <div  *ngIf="message.show && message.text">

      <div class="user_push">
          <div class="close_n" (click)="message.show = false;"><img src="assets/imgs/close.png" alt=""></div>
          <div class="client"> <img [src]="message.driver_thumbnail_url || 'assets/imgs/client.jpg'" *ngIf="message.driver_name">	</div>
          <div class="details">
            <span>
              <p *ngIf="message.driver_name">{{message.driver_name}}</p>
              <p> Route No: <b *ngIf="message.bus_number">{{message.bus_number}} </b></p>
            </span>
            <p>Vehicle No: {{message.registration_number}} </p>
          </div>
          <div class="comments">
            <p> {{message.short_message || message.text}} </p>
            <h1 *ngIf="message.expected_time" > {{message.expected_time | date:'mm'}}</h1> <span class="minutes">mins</span>
            <h2 *ngIf="message.time" > {{message.time | date:'shortTime'}} </h2>
          </div>	
      </div>

  </div>
</ion-footer>

<ion-fab right bottom *ngIf="role === 'DRIVER'">
  <button ion-fab color="default"><ion-icon name="arrow-dropleft"></ion-icon></button>
  <ion-fab-list side="left">
    <button ion-fab *ngIf="!mockData.useMockData"><ion-icon name="ios-navigate-outline" (click)="mockDriver()"></ion-icon></button>
    <button ion-fab *ngIf="mockData.useMockData"><ion-icon name="ios-eye-off-outline" (click)="stopMock()"></ion-icon></button>
  </ion-fab-list>
</ion-fab>
